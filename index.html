<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å‡è„‚æ‰“å¡ä¸­å¿ƒ</title>
  <style>
    :root {
      color-scheme: light dark;
      font-family: "PingFang SC", "Microsoft YaHei", system-ui, -apple-system, sans-serif;
      --green: #38b48b;
      --orange: #ff9f45;
      --bg: #f6f8fb;
      --card: #ffffff;
      --shadow: 0 10px 40px rgba(0,0,0,0.08);
    }
    body {
      margin: 0;
      background: var(--bg);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 32px 16px 64px;
    }
    main {
      width: min(960px, 100%);
    }
    header {
      margin-bottom: 24px;
    }
    h1 {
      margin: 0;
      font-size: clamp(28px, 4vw, 40px);
      color: #111;
    }
    header p {
      margin: 8px 0 0;
      color: #555;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
    }
    section {
      background: var(--card);
      border-radius: 18px;
      padding: 20px 24px 24px;
      box-shadow: var(--shadow);
    }
    section h2 {
      margin: 0 0 12px;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    section p {
      margin: 6px 0;
      color: #666;
    }
    form {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    input, button {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 10px 14px;
      font-size: 15px;
      font-family: inherit;
    }
    input {
      flex: 1;
      min-width: 160px;
      background: #fff;
    }
    button {
      border: none;
      cursor: pointer;
      background: var(--green);
      color: #fff;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(56, 180, 139, 0.3);
    }
    ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .todo-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: #f4f6fb;
    }
    .todo-item.completed {
      opacity: 0.6;
      text-decoration: line-through;
    }
    .todo-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }
    .todo-actions {
      margin-left: auto;
      display: flex;
      gap: 6px;
    }
    .todo-actions button {
      background: transparent;
      border: none;
      color: #888;
      font-size: 14px;
      padding: 0 4px;
      box-shadow: none;
    }
    .todo-actions button:hover {
      color: #111;
      transform: none;
    }
    #history-list {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .history-card {
      padding: 12px 16px;
      border-radius: 14px;
      background: #f4f6fb;
    }
    .history-card strong {
      color: #333;
    }
    .highlight {
      color: var(--orange);
    }
    @media (max-width: 540px) {
      section {
        padding: 18px;
      }
      form {
        flex-direction: column;
      }
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <main>
    <header>
      <h1>æˆ‘çš„å‡è„‚æ‰“å¡ä¸­å¿ƒ</h1>
      <p>è®°å½•ä½“é‡ã€è§„åˆ’æ¯æ—¥å¾…åŠï¼Œå¸®ä½ ç¨³ç¨³æ‹¿ä¸‹ç›®æ ‡èº«æã€‚</p>
      <p id="today-label"></p>
    </header>

    <section style="margin-bottom: 24px;">
      <h2>ğŸ¯ æ¨¡å¼é€‰æ‹©</h2>
      <p>é€‰æ‹©ä¸€å¥—ç³»ç»ŸåŒ–è®¡åˆ’ï¼Œè‡ªåŠ¨ç”Ÿæˆæœªæ¥ä¸¤å‘¨çš„æ¯æ—¥ä»£åŠã€‚</p>
      <form id="mode-form">
        <select id="mode-select">
          <option value="">è‡ªç”±æ¨¡å¼ï¼ˆæ‰‹åŠ¨è§„åˆ’ï¼‰</option>
          <option value="quickBurn">å¿«é€Ÿç‡ƒè„‚æ¨¡å¼ Â· 14 å¤©å†²åˆº</option>
        </select>
        <button type="submit">ç”Ÿæˆæ¨¡å¼ä»£åŠ</button>
      </form>
      <p id="mode-status">å½“å‰ä¸ºè‡ªç”±æ¨¡å¼ï¼Œå¯è‡ªè¡Œæ·»åŠ å¾…åŠã€‚</p>
    </section>

    <div class="grid">
      <section>
        <h2>ğŸ“‹ ä»Šæ—¥å¾…åŠ</h2>
        <p>å…ˆåˆ—å‡ºä»Šå¤©å¿…åšäº‹é¡¹ï¼Œå®Œæˆåå‹¾é€‰å³å¯æ‰“å¡ã€‚</p>
        <form id="todo-form">
          <input id="todo-input" type="text" placeholder="ä¾‹å¦‚ï¼šåƒæ»¡ 120g è›‹ç™½è´¨" required>
          <button type="submit">æ·»åŠ </button>
        </form>
        <ul id="todo-list"></ul>
      </section>

      <section>
        <h2>âš–ï¸ ä½“é‡è®°å½•</h2>
        <p>è¾“å…¥ä»Šæ—¥ä½“é‡ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜è¶‹åŠ¿ã€‚</p>
        <form id="weight-form">
          <input id="weight-input" type="number" step="0.1" min="30" max="200" placeholder="å•ä½ï¼škg" required>
          <button type="submit">è®°å½•ä½“é‡</button>
        </form>
        <p id="weight-status">ä»Šæ—¥å°šæœªè®°å½•ã€‚</p>
      </section>
    </div>

    <section style="margin-top: 24px;">
      <h2>ğŸ“† è¿‘ä¸ƒæ—¥æ¦‚è§ˆ</h2>
      <div id="history-list"></div>
    </section>
  </main>

  <script>
    const STORAGE_KEY = "fat-loss-logs";

    const todayLabel = document.getElementById("today-label");
    const todoForm = document.getElementById("todo-form");
    const todoInput = document.getElementById("todo-input");
    const todoList = document.getElementById("todo-list");
    const weightForm = document.getElementById("weight-form");
    const weightInput = document.getElementById("weight-input");
    const weightStatus = document.getElementById("weight-status");
    const historyList = document.getElementById("history-list");
    const modeForm = document.getElementById("mode-form");
    const modeSelect = document.getElementById("mode-select");
    const modeStatus = document.getElementById("mode-status");

    const todayKey = new Date().toISOString().slice(0, 10);
    todayLabel.textContent = `ä»Šå¤©ï¼š${formatDateLabel(todayKey)}`;

    const MODE_PLANS = {
      quickBurn: {
        name: "å¿«é€Ÿç‡ƒè„‚æ¨¡å¼ Â· ä¸¤å‘¨å‡ 10kg",
        duration: 14,
        days: [
          { title: "ç¬¬1å¤©ï¼šä»£è°¢å¯åŠ¨", todos: ["08:00 200ml æ¸©æ°´+æŸ æª¬ç‰‡å¼€å¯ä»£è°¢", "å…¨å¤©ç¢³æ°´æ§åˆ¶åœ¨ 120g å†…ï¼Œä¼˜å…ˆä½ GI", "åˆå 40 åˆ†é’Ÿå¿«èµ°æˆ–éª‘è¡Œï¼ˆå¿ƒç‡ 120-140ï¼‰", "æ™šä¸Š 10 ç‚¹å‰ç¡è§‰ï¼Œæœç»ç†¬å¤œ"] },
          { title: "ç¬¬2å¤©ï¼šé«˜è›‹ç™½è¡¥ç»™", todos: ["ä¸‰é¤è›‹ç™½è´¨æ‘„å…¥å…± 130gï¼Œå‡è¡¡åˆ†é…", "åŠ é¤æ”¹ç”¨ä½è„‚é…¸å¥¶æˆ–è›‹ç™½ç²‰", "æ™šé¤å 20 åˆ†é’Ÿæ‹‰ä¼¸ï¼Œèˆ’ç¼“è‚Œè‚‰", "ç¡å‰è®°å½•ä½“æ„Ÿå’ŒçŠ¶æ€"] },
          { title: "ç¬¬3å¤©ï¼šåŠ›é‡ç»´åº¦", todos: ["æ—©é¤å‰ 10 åˆ†é’Ÿç©ºè…¹æ‹‰ä¼¸+æ ¸å¿ƒæ¿€æ´»", "åˆé¤å 30 åˆ†é’Ÿä¸‹è‚¢åŠ›é‡è®­ç»ƒï¼ˆæ·±è¹²/ç®­æ­¥è¹²ï¼‰", "è®­ç»ƒå 30 åˆ†é’Ÿå†…è¡¥å…… 20g è›‹ç™½", "å¤œé—´æ³¡è„šï¼Œæ”¾æ¾ç¥ç»ç³»ç»Ÿ"] },
          { title: "ç¬¬4å¤©ï¼šæ§ç›è½»æ–­é£Ÿ", todos: ["ä»Šæ—¥ç›æ‘„å…¥ â‰¤5gï¼Œé¿å…åŠ å·¥é£Ÿå“", "é‡‡ç”¨ 16:8 è½»æ–­é£Ÿçª—å£ï¼ˆ12:00-20:00ï¼‰", "æ™šé¤ä»¥é«˜çº¤è”¬èœ+é±¼è‚‰ä¸ºä¸»", "ç¡å‰ 5 åˆ†é’Ÿå†¥æƒ³ï¼Œç¨³å®šæƒ…ç»ª"] },
          { title: "ç¬¬5å¤©ï¼šå¿ƒè‚ºæå‡", todos: ["ä¸Šåˆç©ºè…¹å¿«èµ° 30 åˆ†é’Ÿ", "ä¸‹åˆ Tabata é—´æ­‡è®­ç»ƒ 8 è½®", "å…¨å¤©é¥®æ°´ â‰¥2500mlï¼Œå‡åŒ€åˆ†é…", "è®°å½•ä»Šæ—¥ä½“é‡åŠå¿ƒæƒ…å˜åŒ–"] },
          { title: "ç¬¬6å¤©ï¼šæ¢å¤+æ‹‰ä¼¸", todos: ["æ—©é¤åŠ å…¥ Omega-3 å¥åº·è„‚è‚ª", "æ™šé—´ 45 åˆ†é’Ÿç‘œä¼½/æ™®æ‹‰ææ‹‰ä¼¸", "æœç»å«ç³–é¥®æ–™ï¼Œæ”¹ç”¨ç™½æ°´æˆ–èŒ¶", "21:30 å‰è¿›å…¥ç¡çœ å‡†å¤‡"] },
          { title: "ç¬¬7å¤©ï¼šå‘¨æ€»ç»“", todos: ["å¤ç›˜å‰ 6 å¤©é¥®é£Ÿæ˜¯å¦è¾¾æ ‡", "è¿›è¡Œ 20 åˆ†é’Ÿä½å†²å‡»æœ‰æ°§ï¼ˆæ¤­åœ†æœº/æ¸¸æ³³ï¼‰", "è®°å½•å½“å‰ä½“é‡ä¸å›´åº¦å˜åŒ–", "ç»™è‡ªå·±å†™ä¸€æ¡é¼“åŠ±è¯­"] },
          { title: "ç¬¬8å¤©ï¼šé«˜çº¤ç»´æ—¥", todos: ["ä¸‰é¤åŠ å…¥é«˜çº¤è”¬èœä¸ç²—ç²®", "é™åˆ¶ç²¾åˆ¶ç¢³æ°´ 80g å†…", "ä¸‹åˆ 30 åˆ†é’Ÿè·³ç»³æˆ–æˆ˜ç»³", "ä¿æŒç«™ç«‹åŠå…¬ â‰¥2 å°æ—¶"] },
          { title: "ç¬¬9å¤©ï¼šåŠ›é‡è¿›é˜¶", todos: ["æ—©é¤è¡¥å…… 30g è›‹ç™½è´¨", "åˆåä¸Šè‚¢åŠ›é‡è®­ç»ƒï¼ˆä¿¯å§æ’‘/åˆ’èˆ¹ï¼‰", "è®­ç»ƒåæ‘„å…¥ 500ml ç”µè§£è´¨æ°´", "æ™šä¸Šåš 15 åˆ†é’Ÿæ³¡æ²«è½´æ”¾æ¾"] },
          { title: "ç¬¬10å¤©ï¼šæ’æ°´ä¸ç¡çœ ", todos: ["å…¨å¤©æ§åˆ¶ç›åˆ†å¹¶è¡¥å……è¶³é‡é’¾ï¼ˆé¦™è•‰/è èœï¼‰", "ä¿è¯åˆä¼‘ 20 åˆ†é’Ÿï¼Œç¼“è§£å‹åŠ›", "æ™šé¤å°‘æ²¹å°‘ç›ï¼Œä¸ƒåˆ†é¥±", "22:00 å‰å…¥ç¡ï¼Œç¡®ä¿ 8 å°æ—¶"] },
          { title: "ç¬¬11å¤©ï¼šåŒæœ‰æ°§æ—¥", todos: ["æ—©æ™šå„å®‰æ’ 25 åˆ†é’Ÿä¸­ä½å¼ºåº¦æœ‰æ°§", "ä¸»é¤ä»¥é±¼è™¾ç±»è›‹ç™½ä¸ºä¸»ï¼Œä½è„‚çƒ¹é¥ª", "ä¸‹åˆ 10 åˆ†é’Ÿè…¹éƒ¨æ ¸å¿ƒè®­ç»ƒ", "å†™ä¸‹ä»Šæ—¥èƒ½é‡å€¼ï¼ˆ1-10 åˆ†ï¼‰"] },
          { title: "ç¬¬12å¤©ï¼šè‚ èƒƒå‹å¥½", todos: ["æ—©é¤æ·»åŠ ç›Šç”ŸèŒæˆ–æ— ç³–é…¸å¥¶", "åˆé¤å¤§é‡ç»¿å¶èœ+é¸¡èƒ¸è‚‰", "æ™šé—´ 40 åˆ†é’Ÿå¿«æ­¥èµ°ï¼Œæ­¥é¢‘ 120+", "ç¡å‰çƒ­æ°´æ³¡è„š 15 åˆ†é’Ÿ"] },
          { title: "ç¬¬13å¤©ï¼šå†²åˆºæ—¥", todos: ["ä¸Šåˆ HIT è®­ç»ƒ 15 åˆ†é’Ÿï¼Œæå‡ä»£è°¢", "å…¨å¤©é›¶ç³–é¥®é£Ÿï¼Œé¿å…åŠ å·¥é›¶é£Ÿ", "å®‰æ’ä¸€æ¬¡ 60 åˆ†é’Ÿæ·±åº¦æ‹‰ä¼¸æˆ–ç­‹è†œæª", "è®°å½•æœ€æƒ³è¾¾æˆçš„ä½“æ€ç»†èŠ‚"] },
          { title: "ç¬¬14å¤©ï¼šåº†åŠŸ+ç»´æŠ¤", todos: ["å¤æµ‹ä½“é‡/å›´åº¦ï¼Œè®°å½•æˆæœ", "åšä¸€é¡¿é«˜è´¨é‡ä½†ä¸æš´é£Ÿçš„å¥–åŠ±é¤", "ä¹¦å†™ 3 æ¡æœªæ¥ç»´æŒè®¡åˆ’", "å®‰æ’ 30 åˆ†é’Ÿä½å¼ºåº¦æœ‰æ°§ï¼Œå¹³ç¨³æ”¶å®˜"] }
        ]
      }
    };

    function loadData() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
      } catch {
        return {};
      }
    }

    function saveData(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function ensureDay(data, day) {
      if (!data[day]) {
        data[day] = { todos: [], weight: "" };
      }
    }

    function createTodo(text) {
      return {
        id: typeof crypto !== "undefined" && crypto.randomUUID ? crypto.randomUUID() : String(Date.now()),
        text,
        done: false
      };
    }

    function renderDay() {
      const data = loadData();
      ensureDay(data, todayKey);

      todoList.innerHTML = "";
      data[todayKey].todos.forEach(todo => {
        const li = document.createElement("li");
        li.className = `todo-item ${todo.done ? "completed" : ""}`;

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = todo.done;
        checkbox.addEventListener("change", () => toggleTodo(todo.id));

        const span = document.createElement("span");
        span.textContent = todo.text;

        const actions = document.createElement("div");
        actions.className = "todo-actions";

        const delBtn = document.createElement("button");
        delBtn.type = "button";
        delBtn.textContent = "åˆ é™¤";
        delBtn.addEventListener("click", () => deleteTodo(todo.id));

        actions.appendChild(delBtn);

        li.appendChild(checkbox);
        li.appendChild(span);
        li.appendChild(actions);
        todoList.appendChild(li);
      });

      const weight = data[todayKey].weight;
      weightStatus.textContent = weight ? `ä»Šæ—¥ä½“é‡ï¼š${weight} kg` : "ä»Šæ—¥å°šæœªè®°å½•ã€‚";
      weightInput.value = weight || "";

      renderHistory(data);
    }

    function addTodo(text) {
      const data = loadData();
      ensureDay(data, todayKey);
      data[todayKey].todos.push(createTodo(text));
      saveData(data);
      renderDay();
    }

    function toggleTodo(id) {
      const data = loadData();
      ensureDay(data, todayKey);
      data[todayKey].todos = data[todayKey].todos.map(todo =>
        todo.id === id ? { ...todo, done: !todo.done } : todo
      );
      saveData(data);
      renderDay();
    }

    function deleteTodo(id) {
      const data = loadData();
      ensureDay(data, todayKey);
      data[todayKey].todos = data[todayKey].todos.filter(todo => todo.id !== id);
      saveData(data);
      renderDay();
    }

    function saveWeight(value) {
      const data = loadData();
      ensureDay(data, todayKey);
      data[todayKey].weight = value;
      saveData(data);
      renderDay();
    }

    function renderHistory(data) {
      const days = Object.keys(data).sort((a, b) => b.localeCompare(a)).slice(0, 7);
      historyList.innerHTML = "";
      if (days.length === 0) {
        historyList.innerHTML = "<p>æš‚æ— å†å²è®°å½•ï¼Œä»Šå¤©å°±å¼€å§‹å§ï¼</p>";
        return;
      }

      days.forEach(day => {
        const { todos, weight } = data[day];
        const finished = todos.filter(todo => todo.done).length;
        const card = document.createElement("div");
        card.className = "history-card";
        card.innerHTML = `
          <strong>${formatDateLabel(day)}</strong>
          <p>ä½“é‡ï¼š${weight ? `<span class="highlight">${weight} kg</span>` : "æœªè®°å½•"}</p>
          <p>å¾…åŠå®Œæˆï¼š${finished}/${todos.length || 1}</p>
        `;
        historyList.appendChild(card);
      });
    }

    function formatDateLabel(dateStr) {
      const date = new Date(dateStr);
      return `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ï¼ˆå‘¨${"æ—¥ä¸€äºŒä¸‰å››äº”å…­"[date.getDay()]}ï¼‰`;
    }

    todoForm.addEventListener("submit", (event) => {
      event.preventDefault();
      const value = todoInput.value.trim();
      if (!value) return;
      addTodo(value);
      todoInput.value = "";
      todoInput.focus();
    });

    weightForm.addEventListener("submit", (event) => {
      event.preventDefault();
      const value = parseFloat(weightInput.value);
      if (Number.isNaN(value)) return;
      saveWeight(value.toFixed(1));
    });

    modeForm.addEventListener("submit", (event) => {
      event.preventDefault();
      const modeKey = modeSelect.value;
      if (!modeKey) {
        modeStatus.textContent = "å½“å‰ä¸ºè‡ªç”±æ¨¡å¼ï¼Œå¯è‡ªè¡Œæ·»åŠ å¾…åŠã€‚";
        return;
      }
      applyMode(modeKey);
    });

    function applyMode(modeKey) {
      const plan = MODE_PLANS[modeKey];
      if (!plan) return;

      const data = loadData();
      const startDate = new Date();

      for (let i = 0; i < plan.duration; i++) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + i);
        const key = date.toISOString().slice(0, 10);
        const dayTodos = plan.days[i] ? plan.days[i].todos : [];
        data[key] = {
          ...data[key],
          todos: dayTodos.map(text => createTodo(text)),
          weight: data[key]?.weight || ""
        };
      }

      saveData(data);
      modeStatus.textContent = `å·²å¯ç”¨ ${plan.name}ï¼Œè¦†ç›–ä»Šå¤©èµ·æœªæ¥ ${plan.duration} å¤©ã€‚`;
      renderDay();
    }

    renderDay();
  </script>
</body>
</html>
